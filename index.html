<html>
<head>
	<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<link rel="stylesheet" type="text/css" href="styles/styles.css">
	<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
</head>
<body>
	<div id="container">
		<h1 id="title"> Movie Genres </h1>
		<div id="part1">
			<div id="genreMarket">
			</div>

			<div id="form">
				<button type="button" id="actButton" class="buttonToggle" onClick="ClickAction(); return false;"> Action </button>
				<button type="button" id="advButton" class="buttonToggle" onClick="ClickAdventure(); return false;"> Adventure </button>
				<button type="button" id="comButton" class="buttonToggle" onClick="ClickComedy(); return false;"> Comedy </button>
				<button type="button" id="docButton" class="buttonToggle" onClick="ClickDocumentary(); return false;"> Documentary </button>
				<button type="button" id="draButton" class="buttonToggle" onClick="ClickDrama(); return false;"> Drama </button>
				<button type="button" id="musButton" class="buttonToggle" onClick="ClickMusical(); return false;"> Musical </button>
				<button type="button" id="tshButton" class="buttonToggle" onClick="ClickTSH(); return false;"> Thriller/Suspense/Horror </button>
			</div>
		</div>


		<div id="part2">
			<div class="genreSegment">
				<div class="third"><h2> Action </h2></div>
				<div class="third" id="actBudgetReg"></div>
				<div class="third" id="actMarketReg"></div>
				<div class="statText"> Text </div>
			</div>
			<div class="genreSegment">
				<div class="third"><h2> Adventure </h2></div>
				<div class="third" id="advBudgetReg"></div>
				<div class="third" id="advMarketReg"></div>
				<div class="statText"> Text </div>
			</div>
			<div class="genreSegment">
				<div class="third"><h2> Comedy </h2></div>
				<div class="third" id="comBudgetReg"></div>
				<div class="third" id="comMarketReg"></div>
				<div class="statText"> Text </div>
			</div>
			<div class="genreSegment">
				<div class="third"><h2> Documentary </h2></div>
				<div class="third" id="docBudgetReg"></div>
				<div class="third" id="docMarketReg"></div>
				<div class="statText"> Text </div>
			</div>
			<div class="genreSegment">
				<div class="third"><h2> Drama </h2></div>
				<div class="third" id="draBudgetReg"></div>
				<div class="third" id="draMarketReg"></div>
				<div class="statText"> Text </div>
			</div>
			<div class="genreSegment">
				<div class="third"><h2> Musical </h2></div>
				<div class="third" id="musBudgetReg"></div>
				<div class="third" id="musMarketReg"></div>
				<div class="statText"> Text </div>
			</div>
			<div class="genreSegment">
				<div class="third"><h2> Thriller/Horror/Suspense </h2></div>
				<div class="third" id="tshBudgetReg"></div>
				<div class="third" id="tshMarketReg"></div>
				<div class="statText"> Text </div>
			</div>
		</div>

		<div id="part3">
			<div id="regression">
			</div>
		</div>
	</div>


	<script>
		var genreWidth = 1000,
    		genreHeight = 667,
    		padding = 90;

    	var actTog = "off";
    	var advTog = "off";
    	var comTog = "off";
    	var draTog = "off";
    	var docTog = "off"; 
    	var musTog = "off";
    	var tshTog = "off";

    	var genreMap, color;

    	var actArray = [];
    	var advArray = [];
    	var comArray = [];
    	var docArray = [];
    	var draArray = [];
    	var musArray = [];
    	var tshArray = [];

    	actBut = document.getElementById("actButton");
    	advBut = document.getElementById("advButton");
    	comBut = document.getElementById("comButton");
    	docBut = document.getElementById("docButton");
    	draBut = document.getElementById("draButton");
    	musBut = document.getElementById("musButton");
    	tshBut = document.getElementById("tshButton");

    	var svgGenre = d3.select("#genreMarket").append("svg")
    		.attr("width", genreWidth)
    		.attr("height", genreHeight);

    	var xScale = d3.scale.linear().domain([1994.5,2016]).range([padding, genreWidth-padding]);
    	var yScale = d3.scale.linear().domain([0,50]).range([genreHeight-padding, padding]);

    	var xAxis = d3.svg.axis().scale(xScale).orient("bottom").tickFormat(d3.format("d"));
    	var yAxis = d3.svg.axis().scale(yScale).orient("left");

    	svgGenre.append("g").attr("class", "axis")
			.attr("transform", "translate(0," + yScale(0) + ")")
			.call(xAxis).selectAll("text").attr("font-size", 12).attr("stroke", "white");

		svgGenre.append("g").attr("class", "axis")
			.attr("transform", "translate(" + xScale(1994.5) + ",0)")
			.call(yAxis).selectAll("text").attr("font-size", 13).attr("stroke", "white");

		svgGenre.append("text").text("Title").attr("x", 475).attr("y", 30).style("font-style", "arial").style("font-size", 20).style("fill", "white");
		svgGenre.append("text").text("Year").attr("x", 475).attr("y", 635).style("font-style", "arial").style("font-size", 20).style("fill", "white");
		svgGenre.append("text").text("% Market Share").attr("x", 2).attr("y", 250).style("font-style", "arial").style("font-size", 20)
			.attr("transform", "rotate(270 80 310)").style("fill","white");


		//store function for making a line in variable
		var makeLine = d3.svg.line().x(function(d) { return xScale(d.x) })
			.y(function(d) { return yScale(d.y)});


		

		d3.csv("genreMarketShareData.csv", function(error, rows) {
				//Array to keep track of ID's of data for access later
				genreMap = d3.map(rows, function(id) {
					//Make ID key to object in map
					return Number(id.ID);
				});

				var coord;
				for (var j = 0; j < genreMap.size(); j++) {
					var thisGenre = genreMap.get(j+1).Genre;
					if (thisGenre == "action"){
						coord = {'x': genreMap.get(j+1).Year, 
						'y': genreMap.get(j+1).Share};
						actArray.push(coord);
					}
					if (thisGenre == "adventure"){
						coord = {'x': genreMap.get(j+1).Year, 
						'y': genreMap.get(j+1).Share};
						advArray.push(coord);
					}
					if (thisGenre == "comedy"){
						coord = {'x': genreMap.get(j+1).Year, 
						'y': genreMap.get(j+1).Share};
						comArray.push(coord);
					}
					if (thisGenre == "documentary"){
						coord = {'x': genreMap.get(j+1).Year, 
						'y': genreMap.get(j+1).Share};
						docArray.push(coord);
					}
					if (thisGenre == "drama"){
						coord = {'x': genreMap.get(j+1).Year, 
						'y': genreMap.get(j+1).Share};
						draArray.push(coord);
					}
					if (thisGenre == "musical"){
						coord = {'x': genreMap.get(j+1).Year, 
						'y': genreMap.get(j+1).Share};
						musArray.push(coord);
					}
					if (thisGenre == "tsh"){
						coord = {'x': genreMap.get(j+1).Year, 
						'y': genreMap.get(j+1).Share};
						tshArray.push(coord);
					}
				}
			});
	


		function ClickAction() {
			//clear existing lines
			if (actTog == "on") {
				svgGenre.selectAll("path.actionLine").remove();
				svgGenre.selectAll("circle.actionCirc").remove();
				actBut.style.backgroundColor = "#1c1c1c";
				actBut.style.color = "white";
				actTog = "off";
			}
			else{

				color = "#2E2EFE"; //blue
				//create line
				svgGenre.append("path").attr("d", makeLine(actArray))
					.attr("stroke", color).attr("fill", "none").attr("stroke-width", 2).attr("class", "actionLine");
					//create circles
				actArray.forEach( function (g) {
					svgGenre.append("circle").attr("cx", xScale(g.x))
						.attr("cy", yScale(g.y)).attr("r", 4)
						.attr("fill", color).attr("class", "actionCirc");
				});
				actBut.style.backgroundColor = color;
				actBut.style.color = "#1c1c1c";
				actTog = "on";
			}
		}

		function ClickAdventure() {
			//clear existing lines
			if (advTog == "on") {
				svgGenre.selectAll("path.adventureLine").remove();
				svgGenre.selectAll("circle.adventureCirc").remove();
				advBut.style.backgroundColor = "#1c1c1c";
				advBut.style.color = "white";
				advTog = "off";
			}
			else{
				//create line
				color = "#9AFE2E"; //green
				svgGenre.append("path").attr("d", makeLine(advArray))
					.attr("stroke", color).attr("fill", "none").attr("stroke-width", 2).attr("class", "adventureLine");
					//create circles
				advArray.forEach( function (g) {
					svgGenre.append("circle").attr("cx", xScale(g.x))
						.attr("cy", yScale(g.y)).attr("r", 4)
						.attr("fill", color).attr("class", "adventureCirc");
				});
				advBut.style.backgroundColor = color;
				advBut.style.color = "#1c1c1c";
				advTog = "on";
			}
		}
		
		function ClickComedy() {
			//clear existing lines
			if (comTog == "on") {
				svgGenre.selectAll("path.comedyLine").remove();
				svgGenre.selectAll("circle.comedyCirc").remove();
				comBut.style.backgroundColor = "#1c1c1c";
				comBut.style.color = "white";
				comTog = "off";
			}
			else{
				//create line
				color = "#FE9A2E"; //orange
				svgGenre.append("path").attr("d", makeLine(comArray))
					.attr("stroke", color).attr("fill", "none").attr("stroke-width", 2).attr("class", "comedyLine");
					//create circles
				comArray.forEach( function (g) {
					svgGenre.append("circle").attr("cx", xScale(g.x))
						.attr("cy", yScale(g.y)).attr("r", 4)
						.attr("fill", color).attr("class", "comedyCirc");
				});
				comBut.style.backgroundColor = color;
				comBut.style.color = "#1c1c1c";
				comTog = "on";
			}
		}

		function ClickDocumentary() {
			//clear existing lines
			if (docTog == "on") {
				svgGenre.selectAll("path.documentaryLine").remove();
				svgGenre.selectAll("circle.documentaryCirc").remove();
				docBut.style.backgroundColor = "#1c1c1c";
				docBut.style.color = "white";
				docTog = "off";
			}
			else{
				//create line
				color = "#FE2E2E"; //red
				svgGenre.append("path").attr("d", makeLine(docArray))
					.attr("stroke", color).attr("fill", "none").attr("stroke-width", 2).attr("class", "documentaryLine");
					//create circles
				docArray.forEach( function (g) {
					svgGenre.append("circle").attr("cx", xScale(g.x))
						.attr("cy", yScale(g.y)).attr("r", 4)
						.attr("fill", color).attr("class", "documentaryCirc");
				});
				docBut.style.backgroundColor = color;
				docBut.style.color = "#1c1c1c";
				docTog = "on";
			}
		}

		function ClickDrama() {
			//clear existing lines
			if (draTog == "on") {
				svgGenre.selectAll("path.dramaLine").remove();
				svgGenre.selectAll("circle.dramaCirc").remove();
				draBut.style.backgroundColor = "#1c1c1c";
				draBut.style.color = "white";
				draTog = "off";
			}
			else{
				//create line
				color = "#9A2EFE"; //purple
				svgGenre.append("path").attr("d", makeLine(draArray))
					.attr("stroke", color).attr("fill", "none").attr("stroke-width", 2).attr("class", "dramaLine");
					//create circles
				draArray.forEach( function (g) {
					svgGenre.append("circle").attr("cx", xScale(g.x))
						.attr("cy", yScale(g.y)).attr("r", 4)
						.attr("fill", color).attr("class", "dramaCirc");
				});
				draBut.style.backgroundColor = color;
				draBut.style.color = "#1c1c1c";
				draTog = "on";
			}
		}

		function ClickMusical() {
			//clear existing lines
			if (musTog == "on") {
				svgGenre.selectAll("path.musicalLine").remove();
				svgGenre.selectAll("circle.musicalCirc").remove();
				musBut.style.backgroundColor = "#1c1c1c";
				musBut.style.color = "white";
				musTog = "off";
			}
			else{
				//create line
				color = "#FA58F4"; //pink
				svgGenre.append("path").attr("d", makeLine(musArray))
					.attr("stroke", color).attr("fill", "none").attr("stroke-width", 2).attr("class", "musicalLine");
					//create circles
				musArray.forEach( function (g) {
					svgGenre.append("circle").attr("cx", xScale(g.x))
						.attr("cy", yScale(g.y)).attr("r", 4)
						.attr("fill", color).attr("class", "musicalCirc");
				});
				musBut.style.backgroundColor = color;
				musBut.style.color = "#1c1c1c";
				musTog = "on";
			}
		}


		function ClickTSH() {
			//clear existing lines
			if (tshTog == "on") {
				svgGenre.selectAll("path.tshLine").remove();
				svgGenre.selectAll("circle.tshCirc").remove();
				tshBut.style.backgroundColor = "#1c1c1c";
				tshBut.style.color = "white";
				tshTog = "off";
			}
			else{
				//create line
				color = "#F4FA58"; //yellow
				svgGenre.append("path").attr("d", makeLine(tshArray))
					.attr("stroke", color).attr("fill", "none").attr("stroke-width", 2).attr("class", "tshLine");
					//create circles
				tshArray.forEach( function (g) {
					svgGenre.append("circle").attr("cx", xScale(g.x))
						.attr("cy", yScale(g.y)).attr("r", 4)
						.attr("fill", color).attr("class", "tshCirc");
				});
				tshBut.style.backgroundColor = color;
				tshBut.style.color = "#1c1c1c";
				tshTog = "on";
			}
		}



	</script>
	<script>

		var regHeight = 700,
			regWidth = 1400;

		var actPoints = [],
			advPoints = [],
			comPoints = [],
			docPoints = [],
			draPoints = [],
			musPoints = [],
			tshPoints = [];

		var regMap;

		var svgReg = d3.select("#regression").append("svg")
    		.attr("width", regWidth)
    		.attr("height", regHeight);

    	var xScaleReg = d3.scale.linear().domain([0,300]).range([padding, regWidth-padding]);
    	var yScaleReg = d3.scale.linear().domain([0,1000]).range([regHeight-padding, padding]);

    	var xAxisReg = d3.svg.axis().scale(xScaleReg).orient("bottom").tickFormat(d3.format("d"));
    	var yAxisReg = d3.svg.axis().scale(yScaleReg).orient("left");

    	svgReg.append("g").attr("class", "axisReg")
			.attr("transform", "translate(0," + yScaleReg(0) + ")")
			.call(xAxisReg).selectAll("text").attr("font-size", 12).attr("stroke", "white");

		svgReg.append("g").attr("class", "axisReg")
			.attr("transform", "translate(" + xScaleReg(0) + ",0)")
			.call(yAxisReg).selectAll("text").attr("font-size", 13).attr("stroke", "white");


		d3.csv("movieBudgetData.csv", function(error, rows) {
			regMap = d3.map(rows, function(d) {
				//Make ID key to object in map
				return Number(d.ID);
			});
			console.log(regMap);

			var coord;
				for (var k = 0; k < regMap.size(); k++) {
					var thisGenre = regMap.get(k+1).Genre;
					console.log(thisGenre);
					if (thisGenre == "action"){
						coord = {'x': regMap.get(k+1).Budget, 
						'y': regMap.get(k+1).Domestic};
						actPoints.push(coord);
						console.log("Act Push");
					}
					if (thisGenre == "adventure"){
						coord = {'x': regMap.get(k+1).Budget, 
						'y': regMap.get(k+1).Domestic};
						advPoints.push(coord);
					}
					if (thisGenre == "comedy"){
						coord = {'x': regMap.get(k+1).Budget,
						'y': regMap.get(k+1).Domestic};
						comPoints.push(coord);
					}
					if (thisGenre == "documentary"){
						coord = {'x': regMap.get(k+1).Budget, 
						'y': regMap.get(k+1).Domestic};
						docPoints.push(coord);
					}
					if (thisGenre == "drama"){
						coord = {'x': regMap.get(k+1).Budget, 
						'y': regMap.get(k+1).Domestic};
						draPoints.push(coord);
					}
					if (thisGenre == "musical"){
						coord = {'x': regMap.get(k+1).Budget, 
						'y': regMap.get(k+1).Domestic};
						musPoints.push(coord);
					}
					if (thisGenre == "tsh"){
						coord = {'x': regMap.get(k+1).Budget, 
						'y': regMap.get(k+1).Domestic};
						tshPoints.push(coord);
					}
				}

		});
		




		//Inspire from Professor Mimno's notes 4/18/16
			function leastSquares(points) {
				var model = {};
				// Replace this with an expression that will filter
				// out points not in the current selection

				var meanX = d3.mean(points, function (d) {
					console.log(d);
					return Number(d.x);
				});
				var meanY = d3.mean(points, function (d) { 
					return Number(d.y);
				});
				model.slope = d3.sum(points, function (d) {
					return (Number(d.x) - meanX) * (Number(d.y) - meanY);
				});
				model.slope /= d3.sum(points, function (d) {
					return (Number(d.x) - meanX) * (Number(d.x) - meanX);
				});
				model.intercept = meanY - model.slope * meanX;
	
				return model;
			}

			slider.oninput = function () {
				if (slider.value <= 14) {

					svgReg.selectAll(".advRegLine").remove();
					svgReg.selectAll("circle.advRegCirc").remove();

					var model = leastSquares(actPoints);
					console.log(model);

					svgReg.append("line")
						.attr("x1", xScaleReg(0))
						.attr("y1", yScaleReg(model.slope * 0 + model.intercept))
						.attr("x2", xScaleReg(300))
						.attr("y2", yScaleReg(model.slope * 300 + model.intercept))
						.style("stroke", "rgb(228, 26, 28)")
						.style("stroke-width", 3)
						.attr("class", "actRegLine");

					actPoints.forEach(function (d) {
						svgReg.append("circle").attr("cx", xScaleReg(d.x))
								.attr("cy", yScaleReg(d.y)).attr("r", 4)
								.attr("fill", "blue").attr("class", "actRegCirc");
					})
				}

				if (slider.value > 14 && slider.value <= 28) {
					svgReg.selectAll(".actRegLine").remove();
					svgReg.selectAll("circle.actRegCirc").remove();
					svgReg.selectAll(".comRegLine").remove();
					svgReg.selectAll("circle.comRegCirc").remove();

					var model = leastSquares(advPoints);
					console.log(model);

					svgReg.append("line")
						.attr("x1", xScaleReg(0))
						.attr("y1", yScaleReg(model.slope * 0 + model.intercept))
						.attr("x2", xScaleReg(300))
						.attr("y2", yScaleReg(model.slope * 300 + model.intercept))
						.style("stroke", "rgb(228, 26, 28)")
						.style("stroke-width", 3)
						.attr("class", "advRegLine");

					advPoints.forEach(function (d) {
						svgReg.append("circle").attr("cx", xScaleReg(d.x))
								.attr("cy", yScaleReg(d.y)).attr("r", 4)
								.attr("fill", "green").attr("class", "advRegCirc");
					})
				}

				if (slider.value > 28 && slider.value <= 42) {
					svgReg.selectAll(".advRegLine").remove();
					svgReg.selectAll("circle.advRegCirc").remove();
					svgReg.selectAll(".docRegLine").remove();
					svgReg.selectAll("circle.docRegCirc").remove();

					var model = leastSquares(comPoints);
					console.log(model);

					svgReg.append("line")
						.attr("x1", xScaleReg(0))
						.attr("y1", yScaleReg(model.slope * 0 + model.intercept))
						.attr("x2", xScaleReg(300))
						.attr("y2", yScaleReg(model.slope * 300 + model.intercept))
						.style("stroke", "rgb(228, 26, 28)")
						.style("stroke-width", 3)
						.attr("class", "comRegLine");

					comPoints.forEach(function (d) {
						svgReg.append("circle").attr("cx", xScaleReg(d.x))
								.attr("cy", yScaleReg(d.y)).attr("r", 4)
								.attr("fill", "orange").attr("class", "comRegCirc");
					})
				}
				if (slider.value > 42 && slider.value <= 56){
					svgReg.selectAll(".comRegLine").remove();
					svgReg.selectAll("circle.comRegCirc").remove();
					svgReg.selectAll(".draRegLine").remove();
					svgReg.selectAll("circle.draRegCirc").remove();

					var model = leastSquares(docPoints);

					svgReg.append("line")
						.attr("x1", xScaleReg(0))
						.attr("y1", yScaleReg(model.slope * 0 + model.intercept))
						.attr("x2", xScaleReg(300))
						.attr("y2", yScaleReg(model.slope * 300 + model.intercept))
						.style("stroke", "rgb(228, 26, 28)")
						.style("stroke-width", 3)
						.attr("class", "docRegLine");

					docPoints.forEach(function (d) {
						svgReg.append("circle").attr("cx", xScaleReg(d.x))
								.attr("cy", yScaleReg(d.y)).attr("r", 4)
								.attr("fill", "red").attr("class", "docRegCirc");
					})
				}
				if (slider.value > 56 && slider.value <= 70){
					svgReg.selectAll(".docRegLine").remove();
					svgReg.selectAll("circle.docRegCirc").remove();
					svgReg.selectAll(".musRegLine").remove();
					svgReg.selectAll("circle.musRegCirc").remove();

					var model = leastSquares(draPoints);

					svgReg.append("line")
						.attr("x1", xScaleReg(0))
						.attr("y1", yScaleReg(model.slope * 0 + model.intercept))
						.attr("x2", xScaleReg(300))
						.attr("y2", yScaleReg(model.slope * 300 + model.intercept))
						.style("stroke", "rgb(228, 26, 28)")
						.style("stroke-width", 3)
						.attr("class", "draRegLine");

					draPoints.forEach(function (d) {
						svgReg.append("circle").attr("cx", xScaleReg(d.x))
								.attr("cy", yScaleReg(d.y)).attr("r", 4)
								.attr("fill", "purple").attr("class", "draRegCirc");
					})
				}

				if (slider.value > 70 && slider.value <= 84){
					svgReg.selectAll(".draRegLine").remove();
					svgReg.selectAll("circle.draRegCirc").remove();
					svgReg.selectAll(".tshRegLine").remove();
					svgReg.selectAll("circle.tshRegCirc").remove();

					var model = leastSquares(musPoints);

					svgReg.append("line")
						.attr("x1", xScaleReg(0))
						.attr("y1", yScaleReg(model.slope * 0 + model.intercept))
						.attr("x2", xScaleReg(300))
						.attr("y2", yScaleReg(model.slope * 300 + model.intercept))
						.style("stroke", "rgb(228, 26, 28)")
						.style("stroke-width", 3)
						.attr("class", "musRegLine");

					musPoints.forEach(function (d) {
						svgReg.append("circle").attr("cx", xScaleReg(d.x))
								.attr("cy", yScaleReg(d.y)).attr("r", 4)
								.attr("fill", "pink").attr("class", "musRegCirc");
					})
				}

				if (slider.value > 84){
					svgReg.selectAll(".musRegLine").remove();
					svgReg.selectAll("circle.musRegCirc").remove();

					var model = leastSquares(tshPoints);

					svgReg.append("line")
						.attr("x1", xScaleReg(0))
						.attr("y1", yScaleReg(model.slope * 0 + model.intercept))
						.attr("x2", xScaleReg(300))
						.attr("y2", yScaleReg(model.slope * 300 + model.intercept))
						.style("stroke", "rgb(228, 26, 28)")
						.style("stroke-width", 3)
						.attr("class", "tshRegLine");

					tshPoints.forEach(function (d) {
						svgReg.append("circle").attr("cx", xScaleReg(d.x))
								.attr("cy", yScaleReg(d.y)).attr("r", 4)
								.attr("fill", "yellow").attr("class", "tshRegCirc");
					})
				}
			}

	</script>


</body>
</html>